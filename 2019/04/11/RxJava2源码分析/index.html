<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Reactive Programming,">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2">






<meta name="description" content="本文将按照如下3个部分组织，分别是:   basics operators schedulers  本文不会很具体沿调用链每个API都一行一行分析，主要了解其原理和设计。">
<meta name="keywords" content="Reactive Programming">
<meta property="og:type" content="article">
<meta property="og:title" content="RxJava2源码分析">
<meta property="og:url" content="https://bboylin.github.io/2019/04/11/RxJava2源码分析/index.html">
<meta property="og:site_name" content="24号程序猿">
<meta property="og:description" content="本文将按照如下3个部分组织，分别是:   basics operators schedulers  本文不会很具体沿调用链每个API都一行一行分析，主要了解其原理和设计。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://reactivex.io/documentation/operators/images/schedulers.png">
<meta property="og:updated_time" content="2019-07-27T13:22:32.900Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RxJava2源码分析">
<meta name="twitter:description" content="本文将按照如下3个部分组织，分别是:   basics operators schedulers  本文不会很具体沿调用链每个API都一行一行分析，主要了解其原理和设计。">
<meta name="twitter:image" content="http://reactivex.io/documentation/operators/images/schedulers.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://bboylin.github.io/2019/04/11/RxJava2源码分析/">





  <title>RxJava2源码分析 | 24号程序猿</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">24号程序猿</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bboylin.github.io/2019/04/11/RxJava2源码分析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="bboylin">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://avatars0.githubusercontent.com/u/16531906?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="24号程序猿">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">RxJava2源码分析</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-11T00:29:19+08:00">
                2019-04-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reactive-Programming/" itemprop="url" rel="index">
                    <span itemprop="name">Reactive Programming</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/11/RxJava2源码分析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/04/11/RxJava2源码分析/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>本文将按照如下3个部分组织，分别是: </p>
<ul>
<li>basics</li>
<li>operators</li>
<li>schedulers</li>
</ul>
<p>本文不会很具体沿调用链每个API都一行一行分析，主要了解其原理和设计。</p>
<a id="more"></a>
<h3 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h3><p>所谓Basics，基本上都是官方文档上的一些不太好理解或者容易忽略的concept。之所以重复这些concept，是因为我发现很多人依然对RxJava不太了解，一提起RxJava，本能就说是函数式编程。其实Rxjava正确来说是响应式编程（reactive stream）在java上的实现。响应式编程和函数式编程其实是两个东西，所谓响应式，是观察者模式，迭代器模式和函数式编程的结合。而函数式编程，在Java8上的实现其实和RxJava看上去十分相似，简单来说就是stream API在不改变原始数据状态的情况下的链式调用，每一步链式调用的参数都是functional method。Rxjava2的Flowable API和上述十分相似，但是不同的是Rxjava的Flowable链式调用最终需要通过subscribe才会执行，而subscribe就是响应式中观察者模式的体现。</p>
<h4 id="Backpressure"><a href="#Backpressure" class="headerlink" title="Backpressure"></a>Backpressure</h4><p>Backpressure简单来说就是生产者消费者问题，当上游emit数据的速度大于下游consume的速度的时候，必然会存在缓存区溢出的可能，如果不进行处理就直接MissingBackpressureException崩了。RxJava2引入了Flowable，和Observable的区别在于前者提供了onBackpressureXXX方法支持Backpressure，后者non-Backpressure。例如：</p>
<ul>
<li><code>onBackpressureBuffer()</code> 解决backPressure最常用的思路就是减少上游发送数据的速率，onBackpressureBuffer()就是再引入一个缓冲区，存储溢出的items。可传入capacity，不传入是unbounded。</li>
<li><code>onBackpressureDrop()</code>将多余的items丢弃。可看作capacity为0，OverflowStrategy为ON_OVERFLOW_DROP_LATEST时候的<code>onBackpressureBuffer()</code></li>
<li><code>onBackpressureLatest()</code>用最新的item代替旧的undelivered item。可看作capacity为1，OverflowStrategy为ON_OVERFLOW_DROP_OLDEST时候的<code>onBackpressureBuffer()</code></li>
</ul>
<h4 id="Hot-Observable-vs-Cold-Observable"><a href="#Hot-Observable-vs-Cold-Observable" class="headerlink" title="Hot Observable vs Cold Observable"></a>Hot Observable vs Cold Observable</h4><p>Hot Observable 发数据不依赖有没有被订阅，有可能一创建就发。Cold Observable需要被订阅才会发数据。通常Observable都是cold的，可通过publish方法将cold observable转化为hot observable。Hot Observable例如ConnectableFlowable和Subject。例如输入事件，其实就是Hot Observable，Hot Observable的observer有可能是收不到所有data的。</p>
<h4 id="Assembly-time"><a href="#Assembly-time" class="headerlink" title="Assembly time"></a>Assembly time</h4><p>observable后面接的一系列操作符在subscribe之前不会产生实际的影响，即不会执行操作符里的变换，原因后面通过源码分析。</p>
<h4 id="subscribeOn和observeOn"><a href="#subscribeOn和observeOn" class="headerlink" title="subscribeOn和observeOn"></a>subscribeOn和observeOn</h4><p>subscribeOn决定了subscribe（注意不是subscribeOn）上游的操作在哪个线程执行，如果调用多次只有第一次会生效，observeOn决定了observeOn的下游操作在哪个线程执行，可调用多次，每次都会生效。</p>
<p><img src="http://reactivex.io/documentation/operators/images/schedulers.png" alt="http://reactivex.io/documentation/operators/images/schedulers.png"></p>
<h3 id="operators"><a href="#operators" class="headerlink" title="operators"></a>operators</h3><p>Rxjava中的操作符我们用的很多，但是里面是怎么实现的呢？以下面这个为例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Flowable.range(<span class="number">1</span>,<span class="number">10</span>)</span><br><span class="line">        .take(<span class="number">5</span>)</span><br><span class="line">        .filter(i -&gt; &#123;<span class="keyword">return</span> i%<span class="number">2</span> == <span class="number">0</span>&#125;)</span><br><span class="line">        .map(i -&gt; i*i)</span><br><span class="line">        .subscribe(i -&gt; print(i))</span><br></pre></td></tr></table></figure></p>
<p>Flowable.range用于产生一个flowable source，我们姑且称之为sourceFlowable。后面依次对这个sourceFlowable进行了take和filter，map操作。这几个操作符的方法实现几乎都是一致的：参数校验，执行hook，创建并返回对象。以take为例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Flowable&lt;T&gt; <span class="title">take</span><span class="params">(<span class="keyword">long</span> count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (count &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"count &gt;= 0 required but it was "</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> FlowableTake&lt;T&gt;(<span class="keyword">this</span>, count));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>RxJavaPlugins这个类提供了很多用于hook RxJava操作的方法，onAssembly便是用于hook操作符的。实际上啥都没做，就返回了一个FlowableTake对象，传入了sourceFlowable。filter和map类似。我们看到整个流程等价于：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 伪代码</span></span><br><span class="line"><span class="keyword">new</span> FlowableMap(<span class="keyword">new</span> FlowableFilter(<span class="keyword">new</span> FlowableTake(sourceflowable))).subscribe(onNext)</span><br></pre></td></tr></table></figure></p>
<p>这一步其实已经解释了为什么在调用subscribe之前，这些操作符对应的变换实际上还没执行。</p>
<p>接下来看subscribe做了什么触发了一系列变换。</p>
<p>首先subscribe(onNext)方法最终会调到：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Disposable <span class="title">subscribe</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; onNext)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> subscribe(onNext, Functions.ON_ERROR_MISSING,</span><br><span class="line">            Functions.EMPTY_ACTION, FlowableInternalHelper.RequestMax.INSTANCE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Disposable <span class="title">subscribe</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; onNext, Consumer&lt;? <span class="keyword">super</span> Throwable&gt; onError,</span></span></span><br><span class="line"><span class="function"><span class="params">        Action onComplete, Consumer&lt;? <span class="keyword">super</span> Subscription&gt; onSubscribe)</span> </span>&#123;</span><br><span class="line">    ObjectHelper.requireNonNull(onNext, <span class="string">"onNext is null"</span>);</span><br><span class="line">    ObjectHelper.requireNonNull(onError, <span class="string">"onError is null"</span>);</span><br><span class="line">    ObjectHelper.requireNonNull(onComplete, <span class="string">"onComplete is null"</span>);</span><br><span class="line">    ObjectHelper.requireNonNull(onSubscribe, <span class="string">"onSubscribe is null"</span>);</span><br><span class="line"></span><br><span class="line">    LambdaSubscriber&lt;T&gt; ls = <span class="keyword">new</span> LambdaSubscriber&lt;T&gt;(onNext, onError, onComplete, onSubscribe);</span><br><span class="line"></span><br><span class="line">    subscribe(ls);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ls;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BackpressureSupport</span>(BackpressureKind.SPECIAL)</span><br><span class="line"><span class="meta">@SchedulerSupport</span>(SchedulerSupport.NONE)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> T&gt; s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s <span class="keyword">instanceof</span> FlowableSubscriber) &#123;</span><br><span class="line">        subscribe((FlowableSubscriber&lt;? <span class="keyword">super</span> T&gt;)s);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ObjectHelper.requireNonNull(s, <span class="string">"s is null"</span>);</span><br><span class="line">        subscribe(<span class="keyword">new</span> StrictSubscriber&lt;T&gt;(s));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>也就是说其实执行的是：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 伪代码</span></span><br><span class="line"><span class="keyword">new</span> FlowableMap(<span class="keyword">new</span> FlowableFilter(<span class="keyword">new</span> FlowableTake(sourceflowable))).subscribe(<span class="keyword">new</span> LambdaSubscriber())</span><br></pre></td></tr></table></figure></p>
<p>而subscribe(LambdaSubscriber ls)方法调用的其实是Flowable的abstract方法：subscribeActual(ls), subscribeActual由Flowable的各个子类重写。</p>
<p>而FlowableMap的subscribeActual如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FlowableMap</span><span class="params">(Flowable&lt;T&gt; source, Function&lt;? <span class="keyword">super</span> T, ? extends U&gt; mapper)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(source);</span><br><span class="line">    <span class="keyword">this</span>.mapper = mapper;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> U&gt; s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s <span class="keyword">instanceof</span> ConditionalSubscriber) &#123;</span><br><span class="line">        source.subscribe(<span class="keyword">new</span> MapConditionalSubscriber&lt;T, U&gt;((ConditionalSubscriber&lt;? <span class="keyword">super</span> U&gt;)s, mapper));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        source.subscribe(<span class="keyword">new</span> MapSubscriber&lt;T, U&gt;(s, mapper));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果我们用=&gt;表示调用过程，那么可以知道：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 伪代码</span></span><br><span class="line"><span class="keyword">new</span> FlowableMap(<span class="keyword">new</span> FlowableFilter(<span class="keyword">new</span> FlowableTake(sourceflowable))).subscribeActual(<span class="keyword">new</span> LambdaSubscriber())</span><br><span class="line"></span><br><span class="line">=&gt; <span class="keyword">new</span> FlowableFilter(<span class="keyword">new</span> FlowableTake(sourceflowable)).subscribeActual(<span class="keyword">new</span> MapSubscriber(<span class="keyword">new</span> LambdaSubscriber(), mapper))</span><br><span class="line">=&gt; <span class="keyword">new</span> FlowableTake(sourceflowable).subscribeActual(<span class="keyword">new</span> FilterSubscriber(<span class="keyword">new</span> MapSubscriber(<span class="keyword">new</span> LambdaSubscriber(), mapper), predicate))</span><br><span class="line">=&gt; sourceflowable.subscribeActual(<span class="keyword">new</span> TakeSubscriber(<span class="keyword">new</span> FilterSubscriber(<span class="keyword">new</span> MapSubscriber(<span class="keyword">new</span> LambdaSubscriber(), mapper), predicate), limit))</span><br></pre></td></tr></table></figure></p>
<p>我们来看sourceFlowable（FlowableRange）的subscribeActual方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> Integer&gt; s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s <span class="keyword">instanceof</span> ConditionalSubscriber) &#123;</span><br><span class="line">        s.onSubscribe(<span class="keyword">new</span> RangeConditionalSubscription(</span><br><span class="line">                (ConditionalSubscriber&lt;? <span class="keyword">super</span> Integer&gt;)s, start, end));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        s.onSubscribe(<span class="keyword">new</span> RangeSubscription(s, start, end));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>即：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flowableRange.subscribeActual(<span class="keyword">new</span> TakeSubscriber(<span class="keyword">new</span> FilterSubscriber(<span class="keyword">new</span> MapSubscriber(<span class="keyword">new</span> LambdaSubscriber(), mapper), predicate), limit))</span><br><span class="line"></span><br><span class="line">=&gt; s.onSubscribe(<span class="keyword">new</span> RangeSubscription(s, start, end))</span><br><span class="line"><span class="comment">// 其中s代表new TakeSubscriber(new FilterSubscriber(new MapSubscriber(new LambdaSubscriber(), mapper), predicate), limit)</span></span><br></pre></td></tr></table></figure></p>
<p>由于这些TakeSubscriber,FilterSubscriber，MapSubscriber的onSubscribe都是调用的downStream的onSubscribe，所以最终调用到的就是<br><code>lambdaSubscriber.onSubscribe(new RangeSubscription(s, start, end)</code>,进而调用到rangeSubscription的request方法，request中调用s的onNext，onComplete和onError。而s的onNext，onComplete和onError又逐层向内调用，依次调用到TakeSubscriber，FilterSubscriber，MapSubscriber，LambdaSubscriber的onNext，onComplete和onError。这些subscriber（除了LambdaSubscriber）的onNext中会执行对应的操作符的逻辑，最终LambdaSubscriber的onNext，onComplete和onError就是我们调用的时候传入的onNext，onComplete和onError。如此一同操作下来就实现了所谓的操作符。</p>
<p>整个流程有些绕。首先是每个操作符都会创建并返回一个Flowable对象，这个Flowable对象层层包裹上游的Flowable对象，其次是最终subscribe的时候每个操作符返回的Flowable对象都重写了subscribeActual方法，随着Flowable的subscribeActual层层向内调用，操作符对应的subscriber也层层包裹，层层包裹后的subscriber又层层向内调用onSubscribe，最终调到subscription的request方法，request逐层调subscriber的onNext, 完成对应的操作符变换。</p>
<p>到这里你也许会感受到，看起来很优雅的操作符其实内部实现也是非常的简单粗暴，就是不断的层层组合。</p>
<h3 id="schedulers"><a href="#schedulers" class="headerlink" title="schedulers"></a>schedulers</h3><h4 id="subscribeOn"><a href="#subscribeOn" class="headerlink" title="subscribeOn"></a>subscribeOn</h4><p>subscribeOn其实也是创建并返回了一个FlowableSubscribeOn对象，持有我们传入的scheduler。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Flowable&lt;T&gt; <span class="title">subscribeOn</span><span class="params">(@NonNull Scheduler scheduler)</span> </span>&#123;</span><br><span class="line">    ObjectHelper.requireNonNull(scheduler, <span class="string">"scheduler is null"</span>);</span><br><span class="line">    <span class="keyword">return</span> subscribeOn(scheduler, !(<span class="keyword">this</span> <span class="keyword">instanceof</span> FlowableCreate));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Flowable&lt;T&gt; <span class="title">subscribeOn</span><span class="params">(@NonNull Scheduler scheduler, <span class="keyword">boolean</span> requestOn)</span> </span>&#123;</span><br><span class="line">    ObjectHelper.requireNonNull(scheduler, <span class="string">"scheduler is null"</span>);</span><br><span class="line">    <span class="keyword">return</span> RxJavaPlugins.onAssembly(<span class="keyword">new</span> FlowableSubscribeOn&lt;T&gt;(<span class="keyword">this</span>, scheduler, requestOn));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而FlowableSubscribeOn的subscribeActual方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(<span class="keyword">final</span> Subscriber&lt;? <span class="keyword">super</span> T&gt; s)</span> </span>&#123;</span><br><span class="line">    Scheduler.Worker w = scheduler.createWorker();</span><br><span class="line">    <span class="keyword">final</span> SubscribeOnSubscriber&lt;T&gt; sos = <span class="keyword">new</span> SubscribeOnSubscriber&lt;T&gt;(s, w, source, nonScheduledRequests);</span><br><span class="line">    s.onSubscribe(sos);</span><br><span class="line"></span><br><span class="line">    w.schedule(sos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建了一个worker，将SubscribeOnSubscriber（实现了Runnable接口）传入schedule方法。schedule方法一通操作会调用到scheduleActual：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ScheduledRunnable <span class="title">scheduleActual</span><span class="params">(<span class="keyword">final</span> Runnable run, <span class="keyword">long</span> delayTime, @NonNull TimeUnit unit, @Nullable DisposableContainer parent)</span> </span>&#123;</span><br><span class="line">    Runnable decoratedRun = RxJavaPlugins.onSchedule(run);</span><br><span class="line"></span><br><span class="line">    ScheduledRunnable sr = <span class="keyword">new</span> ScheduledRunnable(decoratedRun, parent);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!parent.add(sr)) &#123;</span><br><span class="line">            <span class="keyword">return</span> sr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Future&lt;?&gt; f;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (delayTime &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            f = executor.submit((Callable&lt;Object&gt;)sr);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            f = executor.schedule((Callable&lt;Object&gt;)sr, delayTime, unit);</span><br><span class="line">        &#125;</span><br><span class="line">        sr.setFuture(f);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RejectedExecutionException ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">            parent.remove(sr);</span><br><span class="line">        &#125;</span><br><span class="line">        RxJavaPlugins.onError(ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看出就是把SubscribeOnSubscriber抛到线程池执行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    lazySet(Thread.currentThread());</span><br><span class="line">    Publisher&lt;T&gt; src = source;</span><br><span class="line">    source = <span class="keyword">null</span>;</span><br><span class="line">    src.subscribe(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Subscription s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (SubscriptionHelper.setOnce(<span class="keyword">this</span>.upstream, s)) &#123;</span><br><span class="line">        <span class="keyword">long</span> r = requested.getAndSet(<span class="number">0L</span>);</span><br><span class="line">        <span class="keyword">if</span> (r != <span class="number">0L</span>) &#123;</span><br><span class="line">            requestUpstream(r, s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">requestUpstream</span><span class="params">(<span class="keyword">final</span> <span class="keyword">long</span> n, <span class="keyword">final</span> Subscription s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (nonScheduledRequests || Thread.currentThread() == get()) &#123;</span><br><span class="line">        s.request(n);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        worker.schedule(<span class="keyword">new</span> Request(s, n));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从之前对操作符的源码分析部分可以知道run方法里面调上游observable的subscribe方法订阅SubscribeOnSubscriber后，会调到SubscribeOnSubscriber的onSubscribe方法，而onSubscribe里会调到上游的request方法，结合之前对操作符的源码分析知道调上游subscription的request方法会层层调用直到调到最上游的subscription的request方法，而最上游subscription的request方法会层层向下调用下游observable的onNext方法。</p>
<p>所以说subscribeOn不管在哪个位置调用都会影响subscribe之前的所有变换所在的线程。</p>
<h4 id="observeOn"><a href="#observeOn" class="headerlink" title="observeOn"></a>observeOn</h4><p>observeOn同理会返回FlowableObserveOn对象，其subscribeActual方法如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Subscriber&lt;? <span class="keyword">super</span> T&gt; s)</span> </span>&#123;</span><br><span class="line">    Worker worker = scheduler.createWorker();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (s <span class="keyword">instanceof</span> ConditionalSubscriber) &#123;</span><br><span class="line">        source.subscribe(<span class="keyword">new</span> ObserveOnConditionalSubscriber&lt;T&gt;(</span><br><span class="line">                (ConditionalSubscriber&lt;? <span class="keyword">super</span> T&gt;) s, worker, delayError, prefetch));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        source.subscribe(<span class="keyword">new</span> ObserveOnSubscriber&lt;T&gt;(s, worker, delayError, prefetch));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>而ObserveOnSubscriber的onSubscribe方法会调用下游的onSubscribe方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSubscribe</span><span class="params">(Subscription s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (SubscriptionHelper.validate(<span class="keyword">this</span>.upstream, s)) &#123;</span><br><span class="line">        <span class="keyword">this</span>.upstream = s;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (s <span class="keyword">instanceof</span> QueueSubscription) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">            QueueSubscription&lt;T&gt; f = (QueueSubscription&lt;T&gt;) s;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> m = f.requestFusion(ANY | BOUNDARY);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (m == SYNC) &#123;</span><br><span class="line">                sourceMode = SYNC;</span><br><span class="line">                queue = f;</span><br><span class="line">                done = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">                downstream.onSubscribe(<span class="keyword">this</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span> (m == ASYNC) &#123;</span><br><span class="line">                sourceMode = ASYNC;</span><br><span class="line">                queue = f;</span><br><span class="line"></span><br><span class="line">                downstream.onSubscribe(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">                s.request(prefetch);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        queue = <span class="keyword">new</span> SpscArrayQueue&lt;T&gt;(prefetch);</span><br><span class="line"></span><br><span class="line">        downstream.onSubscribe(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        s.request(prefetch);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下游的onSubscribe方法层层调用最终调到最下游的lambdaSubscriber的onSubscribe方法，而lambdaSubscriber的onSubscribe方法会调到subscription的request方法，进而层层调到下游的onnext方法。</p>
<p>理解了的读者就会问了，线程切换在哪一步呢？来看ObserveOnSubscriber对象里的onNext方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (done) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sourceMode == ASYNC) &#123;</span><br><span class="line">        trySchedule();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!queue.offer(t)) &#123;</span><br><span class="line">        upstream.cancel();</span><br><span class="line"></span><br><span class="line">        error = <span class="keyword">new</span> MissingBackpressureException(<span class="string">"Queue is full?!"</span>);</span><br><span class="line">        done = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    trySchedule();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到不同于大部分subscriber的onNext方法，这里调用了<code>trySchedule（）</code>切换线程再往后执行：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">trySchedule</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getAndIncrement() != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    worker.schedule(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (outputFused) &#123;</span><br><span class="line">        runBackfused();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sourceMode == SYNC) &#123;</span><br><span class="line">        runSync();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        runAsync();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">runBackfused</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">runSync</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">runAsync</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>ObserveOnSubscriber的runBackfused/runSync/runAsync方法继续调下游的onNext方法，所以说observeOn只会改变调用observeOn的地方的下游操作所在线程，并且是可以多次调用生效的。</p>
<hr>
<p>Rxjava操作符众多，本文没有一一研究其作用，主要是了解operators和schedulers背后的原理。可以看出RxJava原理并没有很复杂，但是只有了解其原理才能知道如何结合实际场景正确使用甚至造一个轮子。参照源码的实现我写了个简陋的RxJava，可以帮助读者更好的理解本文所述原理。地址：<a href="https://github.com/bboylin/RxJavaDemo" target="_blank" rel="noopener">https://github.com/bboylin/RxJavaDemo</a></p>
<p>参考：</p>
<ul>
<li><a href="http://reactivex.io/documentation/subject.html" target="_blank" rel="noopener">http://reactivex.io/documentation/subject.html</a></li>
<li><a href="http://reactivex.io/documentation/operators.html#creating" target="_blank" rel="noopener">http://reactivex.io/documentation/operators.html#creating</a></li>
<li><a href="https://medium.com/upday-devs/rxjava-subscribeon-vs-observeon-9af518ded53a" target="_blank" rel="noopener">https://medium.com/upday-devs/rxjava-subscribeon-vs-observeon-9af518ded53a</a></li>
<li><a href="http://reactivex.io/documentation/scheduler.html" target="_blank" rel="noopener">http://reactivex.io/documentation/scheduler.html</a></li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Reactive-Programming/" rel="tag"># Reactive Programming</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/03/19/Java同步小结/" rel="next" title="Java同步小结">
                <i class="fa fa-chevron-left"></i> Java同步小结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/06/25/慎用继承/" rel="prev" title="慎用继承">
                慎用继承 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="https://avatars0.githubusercontent.com/u/16531906?s=460&v=4" alt="bboylin">
          <p class="site-author-name" itemprop="name">bboylin</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/categories/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/bboylin" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:bboylin24@gmail.com" target="_blank" title="email">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                    
                      email
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/5297849126" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.zhihu.com/people/bboylin" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-user-md"></i>
                  
                    
                      zhihu
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.wanandroid.com" title="玩Android" target="_blank">玩Android</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Basics"><span class="nav-number">1.</span> <span class="nav-text">Basics</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Backpressure"><span class="nav-number">1.1.</span> <span class="nav-text">Backpressure</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hot-Observable-vs-Cold-Observable"><span class="nav-number">1.2.</span> <span class="nav-text">Hot Observable vs Cold Observable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Assembly-time"><span class="nav-number">1.3.</span> <span class="nav-text">Assembly time</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#subscribeOn和observeOn"><span class="nav-number">1.4.</span> <span class="nav-text">subscribeOn和observeOn</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#operators"><span class="nav-number">2.</span> <span class="nav-text">operators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#schedulers"><span class="nav-number">3.</span> <span class="nav-text">schedulers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#subscribeOn"><span class="nav-number">3.1.</span> <span class="nav-text">subscribeOn</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#observeOn"><span class="nav-number">3.2.</span> <span class="nav-text">observeOn</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bboylin</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  

    
      <script id="dsq-count-scr" src="https://bboylin.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://bboylin.github.io/2019/04/11/RxJava2源码分析/';
          this.page.identifier = '2019/04/11/RxJava2源码分析/';
          this.page.title = 'RxJava2源码分析';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://bboylin.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  








  





  

  

  

  

  

  

</body>
</html>
